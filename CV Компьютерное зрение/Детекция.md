## Метрика  
##### mAP  
Метрика крайне замороченная. Нужно свести в одно числа 2 параметра:  
1. Точность бокса  
2. Confidence класса  
Для каждого класса:  
1. Хотим получить Precision Recall Curve.  
2. Цикл по трешхолдам confidence.  
3. Трешхолд по IOU => TP, FP, FN.  
4. mAP = area under PR Curve.  
Выход метрики заключён в диапазоне `[0,1]`.  
  
## Подход детекции  
##### Non Maximum Suppression  
Задача детекции - предсказать много боксов, а потом отфильтровать, чтобы оставить лучший.  
![[Pasted image 20230607173315.png]]  
  
## Детекторы  
### Одноэтапные методы  
#### YOLO'15 (You Only Look Once)  
Первая попытка сделать возможной детекцию в реальном времени.  
  
На выходе модели должно быть:  
- 4 координаты краёв бокса  
- 1 координата центра бокса  
- Вероятность принадлежности к каждому классу  
Т.е. сеть представляет из себя набор ячеек, и для каждой классификатор и 5 регрессоров.  
![[Pasted image 20230607183108.png]]  
Обучение сети:  
1. Берётся сеть для классификации (VGG или ResNet), отрезается Dense слой. Выход такой сети будет отдавать heatmap (тепловую карту) объектов.  
2. Картинка делится на матрицу регионов S x S.  
3. Каждая ячейка описывает несколько вариантов местоположения бокса для одного и того же объекта.   
4. Классификатор для каждой ячейки оценивает принадленость к определенному классу.  
5. Применяется [[Детекция#Non Maximum Suppression|Non Maximum Suppression]] для выделения лучшего бокса.  
Последний слой сети, принимающий решение об окончательном расположении бокса для детекции объекта, а также уверенность принадлежности к классу, работает с тензором размерности S x S x (5B + C), где S x S - количество ячеек, B - количество предсказываемых боксов для ячейки), C - количество классов объектов.  
  
>Такой метод быстрее, чем R-CNN за счёт того, что поддерживает дробление на определенное количество вместо динамичного определения региона и принятия для него решения. В качестве проблемы нужно отметить плохое качество распознавания объектов сложной формы или группы небольших объектов.  
>Также стоит отметить, что энкодер YOLO очень замороченный, поэтому немодифицированную изначальную её версию будет довольно трудно обучать.  
  
#### SSD'15 (Single Shot Detection)  
В YOLO имелась проблема с масштабированием, поэтому было предложено использовать концепцию [[Сегментация#FPN|Пирамидальной иерархии выводов (Как FPN)]].  
![[Pasted image 20230607190006.png]]  
Принятие решения по детекции объектов происходит не только на основе последнего сверточного слоя, но основании всех слоев энкодера.   
  
Такое решение помогает детектировать объекты разных масштабов по той причине, что первые слои энкодера хорошо определяют рамки мелких объектов. Последние же слои - крупных объектов.  
  
В отличие от YOLO, SSD не разбивает изображение на сетку определенного размера, а предсказывает смещение ключевых рамок.   
  
>Скорость распознавания меньше, чем у YOLO, но у SSD точность детектирования лучше.